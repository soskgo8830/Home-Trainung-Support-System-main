<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
        integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/js/all.min.js"
        crossorigin="anonymous"></script>
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-material-design/0.5.10/css/bootstrap-material-design.min.css" />
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-material-design/0.5.10/css/ripples.min.css" />
    <link rel="stylesheet" href="/datepicker/bootstrap-material-datetimepicker.css" />
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,500' rel='stylesheet' type='text/css'>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="/stylesheets/index.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"
        integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-material-design/0.5.10/js/ripples.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-material-design/0.5.10/js/material.min.js"></script>
    <script type="text/javascript" src="http://momentjs.com/downloads/moment-with-locales.min.js"></script>
    <script type="text/javascript" src="/datepicker/bootstrap-material-datetimepicker.js"></script>

    <style>
        body {
            padding-top: 70px;
            font-family: 'Roboto', sans-serif;
        }

        h2 {
            padding: 0 20px 10px 20px;
            font-size: 20px;
            font-weight: 400;
        }

        .form-control-wrapper {
            margin: 10px 20px;
        }

        code {
            padding: 10px;
            background: #eee !important;
            display: block;
            color: #000;
        }

        code>p {
            font-weight: bold;
            color: #000;
            font-size: 1.5em;
        }

        .hidden {
            display: none;
        }

        .year-picker-item {
            color: black;
        }

        @media(max-width: 300px) {
            .well {
                margin: 0
            }
        }
    </style>
    <script>
        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
        ga('create', 'UA-60343429-1', 'auto');
        ga('send', 'pageview');
    </script>
</head>

<body>
    <header>
        <div class="fixed-top">
            <header class="topbar">
                <div class="container">
                    <div class="row">
                        <div class="col-sm-12">
                            <ul class="social-network">
                                <h4 style="color: white;"><i class="fas fa-user-plus"></i> <%= userid %> </h4>
                                <a href="/login" style="color:white;">로그아웃</a>
                            </ul>
                        </div>
                    </div>
                </div>
            </header>
            <nav class="navbar navbar-expand-lg navbar-dark mx-background-top-linear">
                <div class="container">
                    <a class="navbar-brand" style="text-transform: uppercase">Home Training Service</a>
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive"
                        aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarResponsive">
                        <ul class="navbar-nav ml-auto">
                            <li class="nav-item">
                                <a class="nav-link " href="/exercise">운동트레이너
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link active" href="/viewdata">기록확인</a>
                            </li>
                            <li class="nav-item ">
                                <a class="nav-link" href="/bmi">BML계산</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link " href="/sport">운동시설안내</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </nav>
        </div>
    </header>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="card text-white bg-dark mb-3">
                    <div class="card-header"><%= userid %>님의 운동량 변화</div>
                    <hr>
                    <div class="card-body">
                        <canvas id="lineChart" style="height: 20vh;"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="container">
        <div class="row">
            <div class="col-sm-4">
                <div class="card text-white bg-dark mb-3">
                    <div class="card-header">
                        날짜 검색
                    </div>
                    <hr>
                    <div class="card-body" id="date">
                    </div>
                    <hr>
                </div>
            </div>
            <div class="col-sm-8">
                <div class="card text-white bg-dark mb-3">
                    <div class="card-header">
                        상세 데이터
                    </div>
                    <hr>
                    <div class="card-body">
                        <div class="row">
                            <canvas id="pieChart" style="height: 40vh;"></canvas>
                        </div>
                    </div>
                    <hr>
                    <div id="KCAL">
                    </div>
                    <div id="SUMKCAL">
                    </div>
                    <hr>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>

    <script>
        var data = <%- data %>;
        var groupDate = <%- groupDate %>;
        var ctx = document.getElementById('lineChart').getContext('2d');
        var pie = document.getElementById('pieChart').getContext('2d');
        var myPieChart = null;
        var chartData = []
        var label = []
        $.each(groupDate, function (i, v) {
            var temp_Date = new Date(v["date"])
            chartData.push(v["kcal"])
            label.push(temp_Date.getFullYear() + "-" + (temp_Date.getMonth() + 1) + "-" 
            + temp_Date.getDate());
        })
        var chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: label,
                datasets: [{
                    label: 'Kcal',
                    borderColor: 'rgb(0, 255, 0)',
                    hoverBackgroundColor: 'rgb(0, 255, 0)',
                    borderWidth: 2,
                    data: chartData
                }]
            },
            options: { maintainAspectRatio: false }
        });
        myPieChart = new Chart(pie, {
            type: 'pie',
            data: {
                labels: ['스쿼트', '푸쉬업', '윗몸일으키기'],
                datasets: [{
                    data: [0, 0, 0],
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.2)',
                        'rgba(54, 162, 235, 0.2)',
                        'rgba(255, 206, 86, 0.2)',
                    ],
                    borderColor: [
                        'rgba(255, 99, 132, 1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 206, 86, 1)',
                    ],
                    borderWidth: 2
                }]
            },
            options: {
                legend: {
                    labels: {
                        fontColor: "white"
                    }
                },
            }
        });
        $(document).ready(function () {
            $('#date').bootstrapMaterialDatePicker
                ({  time: false,
                    clearButton: true
                });
            $.material.init()
            $("#ok_btn").on("click", function (event) {
                var year_mon = $(".dtp-picker-month").text().split(" ")
                var day = $(".selected").text()
                var mon = new Date(year_mon[1] + "-" + year_mon[0] + "-" + day).getMonth() + 1
                var date = moment(year_mon[1] + "-" + mon + "-" + day)
                var Sel_data = { 'squat': 0, 'pushup': 0, 'abdominal': 0 }
                $.each(data, function (i, v) {
                    var temp_date = moment(v.date);
                    if (temp_date.diff(date) == 0) {
                        Sel_data[v.sporttype] += v.count
                    }
                })
                myPieChart.data.datasets.forEach((dataset) => {
                    dataset.data = [Sel_data.squat, Sel_data.pushup, Sel_data.abdominal];
                });
                var sum = (Sel_data.squat * 0.4) + (Sel_data.pushup * 0.3) + (Sel_data.abdominal * 0.2);
                var p = $("#KCAL").text(" 운동별 칼로리 = 스쿼트 " + (Sel_data.squat * 0.4).toFixed(2)
                 + " kcal , 푸쉬업 : " + (Sel_data.pushup * 0.3).toFixed(2) + " kcal , 윗몸일으키기 : " 
                 + (Sel_data.abdominal * 0.2).toFixed(2) + " kcal");
                var sum = $('#SUMKCAL').text(" 총소모 칼로리 = " + sum.toFixed(2) + " kcal");
                myPieChart.update()
            })
        });
    </script>

    <script type="text/javascript">
    </script>
</body>

</html>